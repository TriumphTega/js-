{
  "rules": {
    // ═══════════════════════════════════════════════════════════════
    // BASE CAMP ALPHA - EXISTING RULES (DO NOT DELETE)
    // These are your original rules for the base game
    // ═══════════════════════════════════════════════════════════════

    // User colony data - users can only access their own data
    // This stores Lunaris tokens, oxygen, hydroponics, energy, etc.
    "colony-data": {
      "$uid": {
        ".read": "auth != null && auth.uid == $uid",
        ".write": "auth != null && auth.uid == $uid",
        // Validation for colony data fields
        ".validate": "newData.hasChildren(['lunaris', 'oxygen', 'hydroponics', 'energy'])",
        "lunaris": {
          ".validate": "newData.isNumber() && newData.val() >= 0"
        },
        "oxygen": {
          ".validate": "newData.isNumber() && newData.val() >= 0 && newData.val() <= 100"
        },
        "hydroponics": {
          ".validate": "newData.isNumber() && newData.val() >= 0 && newData.val() <= 100"
        },
        "energy": {
          ".validate": "newData.isNumber() && newData.val() >= 0 && newData.val() <= 100"
        },
        "streak": {
          ".validate": "newData.isNumber() && newData.val() >= 0"
        }
      }
    },

    // BASE CAMP ALPHA - User progress/XP data
    // Stores totalXP, level, loginDays for progression system
    "user-progress": {
      "$uid": {
        ".read": "auth != null && auth.uid == $uid",
        ".write": "auth != null && auth.uid == $uid",
        "totalXP": {
          ".validate": "newData.isNumber() && newData.val() >= 0"
        },
        "level": {
          ".validate": "newData.isNumber() && newData.val() >= 1"
        }
      }
    },

    // BASE CAMP ALPHA - User profiles
    // Stores displayName, role selection, custom settings
    "user-profiles": {
      "$uid": {
        ".read": "auth != null && auth.uid == $uid",
        ".write": "auth != null && auth.uid == $uid"
      }
    },

    // BASE CAMP ALPHA - User wallets
    // Stores Solana wallet addresses for each user
    "user-wallets": {
      "$uid": {
        ".read": "auth != null && auth.uid == $uid",
        ".write": "auth != null && auth.uid == $uid"
      }
    },

    // BASE CAMP ALPHA - Wallet-based authentication
    // For users who sign in with Phantom/Solflare/Jupiter wallets
    "wallet-users": {
      "$walletAddress": {
        ".read": "auth != null",
        ".write": "auth != null"
      }
    },

    // BASE CAMP ALPHA - Colony role signups
    // Tracks which role users selected (Engineer, Explorer, etc.)
    "colony-signups": {
      "$uid": {
        ".read": "auth != null && auth.uid == $uid",
        ".write": "auth != null && auth.uid == $uid"
      }
    },

    // BASE CAMP ALPHA - Admin access list
    // Only admins can read/write this list
    "admins": {
      ".read": "auth != null && root.child('admins').child(auth.uid).exists()",
      ".write": "auth != null && root.child('admins').child(auth.uid).exists()"
    },

    // BASE CAMP ALPHA - Task configuration rules
    // Admins can customize task types and rewards
    "task-rules": {
      ".read": "auth != null",
      ".write": "auth != null && root.child('admins').child(auth.uid).exists()"
    },

    // BASE CAMP ALPHA - Colony chat messages
    // All authenticated users can read and write messages
    "chat-messages": {
      ".read": "auth != null",
      ".write": "auth != null"
    },

    // ═══════════════════════════════════════════════════════════════
    // NEXUS CRATER - NEW RULES FOR PHASE 2 (Trade & Social Hub)
    // These rules enable the daily resource claim system and marketplace
    // ═══════════════════════════════════════════════════════════════

    // NEXUS CRATER - Daily Resources (Global Pool)
    // Tracks app-wide limited resources that reset daily at 00:00 UTC
    // Everyone competes for the same pool (first-come, first-served)
    "nexus-daily-resources": {
      "$date": {
        ".read": true,
        ".write": "auth != null",
        ".validate": "newData.hasChildren(['premiumOxygen', 'hyperHydroponics', 'energyCrystal', 'lunarisBonus'])",
        "$resource": {
          ".validate": "newData.hasChildren(['total', 'claimed', 'lastUpdate']) && newData.child('claimed').val() <= newData.child('total').val()",
          "total": {
            ".validate": "newData.isNumber() && newData.val() >= 0"
          },
          "claimed": {
            ".validate": "newData.isNumber() && newData.val() >= 0"
          },
          "lastUpdate": {
            ".validate": "newData.isNumber()"
          }
        }
      }
    },

    // NEXUS CRATER - User Claims Tracking
    // Records which resources each user claimed on each day
    // Prevents users from claiming the same resource twice per day
    "nexus-user-claims": {
      "$userId": {
        ".read": "auth != null && auth.uid == $userId",
        ".write": "auth != null && auth.uid == $userId",
        "$date": {
          "$resourceType": {
            ".validate": "newData.hasChildren(['claimed', 'timestamp', 'amount'])",
            "claimed": {
              ".validate": "newData.isBoolean()"
            },
            "timestamp": {
              ".validate": "newData.isNumber()"
            },
            "amount": {
              ".validate": "newData.isNumber() && newData.val() > 0"
            }
          }
        }
      }
    },

    // NEXUS CRATER - Marketplace Listings
    // Users can create listings to sell oxygen, hydroponics, energy
    // Buyers can purchase from active listings using Lunaris tokens
    "nexus-marketplace-listings": {
      ".read": true,
      "$listingId": {
        ".write": "auth != null && (!data.exists() || data.child('sellerId').val() == auth.uid || newData.child('buyerId').val() == auth.uid)",
        ".validate": "newData.hasChildren(['sellerId', 'resourceType', 'amount', 'pricePerUnit', 'totalPrice', 'status']) && newData.child('amount').val() >= 10 && newData.child('pricePerUnit').val() >= 1 && (newData.child('status').val() == 'active' || newData.child('status').val() == 'sold' || newData.child('status').val() == 'cancelled')",
        "sellerId": {
          ".validate": "newData.isString()"
        },
        "resourceType": {
          ".validate": "newData.isString() && (newData.val() == 'oxygen' || newData.val() == 'hydroponics' || newData.val() == 'energy')"
        },
        "amount": {
          ".validate": "newData.isNumber() && newData.val() >= 10"
        },
        "pricePerUnit": {
          ".validate": "newData.isNumber() && newData.val() >= 1"
        },
        "totalPrice": {
          ".validate": "newData.isNumber() && newData.val() >= 10"
        },
        "status": {
          ".validate": "newData.isString() && (newData.val() == 'active' || newData.val() == 'sold' || newData.val() == 'cancelled')"
        }
      }
    },

    // NEXUS CRATER - Trade History
    // Record of completed trades between users
    // Both buyer and seller can view their own trade history
    "nexus-trade-history": {
      "$tradeId": {
        ".read": "auth != null && (data.child('buyerId').val() == auth.uid || data.child('sellerId').val() == auth.uid)",
        ".write": "auth != null && !data.exists()",
        ".validate": "newData.hasChildren(['buyerId', 'sellerId', 'resourceType', 'amount', 'price', 'timestamp', 'type'])",
        "buyerId": {
          ".validate": "newData.isString()"
        },
        "sellerId": {
          ".validate": "newData.isString()"
        },
        "resourceType": {
          ".validate": "newData.isString()"
        },
        "amount": {
          ".validate": "newData.isNumber() && newData.val() > 0"
        },
        "price": {
          ".validate": "newData.isNumber() && newData.val() > 0"
        },
        "timestamp": {
          ".validate": "newData.isNumber()"
        },
        "type": {
          ".validate": "newData.isString() && (newData.val() == 'marketplace' || newData.val() == 'direct')"
        }
      }
    },

    // NEXUS CRATER - Reputation System
    // Tracks user reputation for trading (6 levels: Newcomer to Legend)
    // Earned through trades, daily claims, and activity streaks
    "nexus-reputation": {
      "$userId": {
        ".read": true,
        ".write": "auth != null",
        ".validate": "newData.hasChildren(['totalRep', 'level']) && newData.child('totalRep').val() >= 0 && newData.child('level').val() >= 1 && newData.child('level').val() <= 6",
        "totalRep": {
          ".validate": "newData.isNumber() && newData.val() >= 0"
        },
        "level": {
          ".validate": "newData.isNumber() && newData.val() >= 1 && newData.val() <= 6"
        },
        "tradesCompleted": {
          ".validate": "newData.isNumber() && newData.val() >= 0"
        },
        "claimStreak": {
          ".validate": "newData.isNumber() && newData.val() >= 0"
        },
        "lastClaimDate": {
          ".validate": "newData.isString()"
        },
        "lastActiveDate": {
          ".validate": "newData.isString()"
        }
      }
    },

    // NEXUS CRATER - Market Prices
    // Dynamic pricing for oxygen, hydroponics, and energy resources
    // Prices fluctuate based on supply/demand (1-100 Lunaris range)
    "nexus-market-prices": {
      ".read": true,
      ".write": "auth != null",
      "$resource": {
        ".validate": "newData.hasChildren(['price', 'change', 'lastUpdate']) && newData.child('price').val() >= 1",
        "price": {
          ".validate": "newData.isNumber() && newData.val() >= 1 && newData.val() <= 100"
        },
        "change": {
          ".validate": "newData.isString()"
        },
        "lastUpdate": {
          ".validate": "newData.isNumber()"
        }
      }
    },

    // NEXUS CRATER - Resource Rush Mini-Game
    // Tracks daily attempts, high scores, and rewards from the arcade game
    // Each user gets 3 attempts per day (resets at 00:00 UTC)
    "nexus-resource-rush": {
      "$userId": {
        ".read": "auth != null && auth.uid == $userId",
        ".write": "auth != null && auth.uid == $userId",
        "$date": {
          ".validate": "newData.hasChildren(['attemptsUsed', 'highScore', 'lastPlayed'])",
          "attemptsUsed": {
            ".validate": "newData.isNumber() && newData.val() >= 0 && newData.val() <= 3"
          },
          "highScore": {
            ".validate": "newData.isNumber() && newData.val() >= 0"
          },
          "lastPlayed": {
            ".validate": "newData.isNumber()"
          },
          "totalRewards": {
            ".validate": "newData.isNumber() && newData.val() >= 0"
          }
        }
      }
    }
  }
}
