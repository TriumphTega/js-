<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset='utf-8'>
    <meta http-equiv='X-UA-Compatible' content='IE=edge'>
    <title>Console - Role Selection</title>
    <meta name='viewport' content='width=device-width, initial-scale=1'>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            min-height: 100vh;
            background: linear-gradient(135deg, #1e5128 0%, #2d6a4f 50%, #1e5128 100%);
            color: white;
            font-family: 'Courier New', Courier, monospace;
            padding: 20px;
        }

        #app-container {
            max-width: 900px;
            margin: 0 auto;
        }

        .header-section {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
            border: 2px solid rgba(255, 204, 0, 0.3);
            text-align: center;
        }

        .page-title {
            font-size: clamp(2rem, 5vw, 3rem);
            color: #FFCC00;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
            margin-bottom: 15px;
        }

        .user-greeting {
            color: rgba(255, 204, 0, 0.8);
            font-size: 1.2rem;
            margin-top: 10px;
        }

        .nav-btn {
            padding: 12px 25px;
            background-color: rgba(255, 204, 0, 0.2);
            color: #FFCC00;
            border: 2px solid #FFCC00;
            border-radius: 8px;
            font-family: 'Courier New', Courier, monospace;
            font-size: 1rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-block;
            margin-top: 15px;
        }

        .nav-btn:hover {
            background-color: rgba(255, 204, 0, 0.4);
            transform: translateY(-2px);
            box-shadow: 0 4px 10px rgba(255, 204, 0, 0.3);
        }

        .role-display {
            display: none;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
            border: 2px solid rgba(255, 204, 0, 0.3);
            text-align: center;
        }

        .role-display h2 {
            color: #FFCC00;
            font-size: 1.8rem;
            margin-bottom: 15px;
        }

        .role-name {
            color: white;
            font-size: 2rem;
            margin: 15px 0;
        }

        .role-lore {
            color: rgba(255, 255, 255, 0.8);
            font-style: italic;
            line-height: 1.6;
            margin: 15px 0;
        }

        .role-lock-message {
            color: #FFCC00;
            margin: 20px 0;
            font-size: 1.1rem;
        }

        .btn {
            padding: 15px 40px;
            background-color: #FFCC00;
            color: #1e5128;
            border: none;
            border-radius: 8px;
            font-family: 'Courier New', Courier, monospace;
            font-size: 1.1rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 10px;
        }

        .btn:hover {
            background-color: #e6b800;
            transform: translateY(-2px);
            box-shadow: 0 4px 10px rgba(255, 204, 0, 0.4);
        }

        .btn-secondary {
            background-color: #32CD32;
            color: white;
        }

        .btn-secondary:hover {
            background-color: #28a428;
        }

        /* Modal Styling */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0, 0, 0, 0.85);
            padding: 20px;
        }

        .modal-content {
            background: linear-gradient(135deg, #1e5128 0%, #2d6a4f 100%);
            margin: 30px auto;
            padding: 0;
            border: 3px solid #FFCC00;
            border-radius: 15px;
            width: 90%;
            max-width: 700px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5);
        }

        .modal-header {
            background: rgba(0, 0, 0, 0.4);
            padding: 25px;
            border-bottom: 2px solid rgba(255, 204, 0, 0.3);
            position: sticky;
            top: 0;
            z-index: 10;
        }

        .modal-header h2 {
            color: #FFCC00;
            text-align: center;
            margin: 0;
            font-size: 1.8rem;
        }

        .close-btn {
            color: #FFCC00;
            float: right;
            font-size: 32px;
            font-weight: bold;
            cursor: pointer;
            line-height: 1;
            transition: all 0.3s ease;
        }

        .close-btn:hover {
            color: white;
            transform: scale(1.2);
        }

        .modal-body {
            padding: 25px;
        }

        .options-container {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .role-option {
            display: block;
            background: rgba(0, 0, 0, 0.3);
            border: 2px solid rgba(255, 204, 0, 0.3);
            border-radius: 10px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .role-option:hover {
            border-color: #FFCC00;
            background: rgba(255, 204, 0, 0.1);
            transform: translateX(5px);
        }

        .role-option input[type="radio"] {
            margin-right: 10px;
            cursor: pointer;
            transform: scale(1.3);
        }

        .role-option input[type="radio"]:checked {
            accent-color: #FFCC00;
        }

        .role-content {
            color: white;
        }

        .role-title {
            color: #FFCC00;
            font-size: 1.3rem;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .role-content ul {
            list-style: none;
            margin: 8px 0;
            padding-left: 0;
        }

        .role-content li {
            margin: 5px 0;
            padding-left: 20px;
            position: relative;
            line-height: 1.5;
        }

        .role-content li:before {
            content: "‚Üí";
            position: absolute;
            left: 0;
            color: #FFCC00;
        }

        .role-content strong {
            color: #FFCC00;
        }

        .confirm-btn {
            width: 100%;
            padding: 15px;
            background-color: #FFCC00;
            color: #1e5128;
            border: none;
            border-radius: 8px;
            font-family: 'Courier New', Courier, monospace;
            font-size: 1.2rem;
            font-weight: bold;
            cursor: pointer;
            margin-top: 20px;
            transition: all 0.3s ease;
        }

        .confirm-btn:hover {
            background-color: #e6b800;
            transform: translateY(-2px);
            box-shadow: 0 4px 10px rgba(255, 204, 0, 0.4);
        }

        /* Instructions Modal Styling */
        .instructions-section {
            text-align: left;
            line-height: 1.8;
        }

        .instructions-section h3 {
            color: #FFCC00;
            margin-top: 25px;
            margin-bottom: 10px;
            font-size: 1.4rem;
        }

        .instructions-section p {
            color: rgba(255, 255, 255, 0.9);
            margin-bottom: 15px;
        }

        .instructions-section ul, .instructions-section ol {
            margin-left: 25px;
            margin-bottom: 15px;
        }

        .instructions-section li {
            margin: 8px 0;
            color: rgba(255, 255, 255, 0.9);
        }

        .instructions-section strong {
            color: #FFCC00;
        }

        @media (max-width: 768px) {
            .modal-content {
                width: 95%;
                margin: 15px auto;
            }

            .modal-header h2 {
                font-size: 1.4rem;
            }

            .role-title {
                font-size: 1.1rem;
            }
        }
    </style>
</head>
<body>
    <div id="app-container">
        <!-- Header Section -->
        <div class="header-section">
            <h1 class="page-title">üéØ Mission Control</h1>
            <p class="user-greeting" id="userGreeting"></p>
            <a href="/index.html" class="nav-btn">‚Üê Back to Home</a>
        </div>

        <!-- Role Display (shown after role selection) -->
        <div class="role-display" id="roleDisplay">
            <h2>Your Role</h2>
            <div class="role-name" id="currentRoleName"></div>
            <p class="role-lore" id="currentRoleLore"></p>
            <p class="role-lock-message">üîí Role permanently locked</p>
            <button id="progressBtn" class="btn">Continue to Instructions ‚Üí</button>
        </div>

        <!-- Select Role Button (hidden after role is selected) -->
        <div style="text-align: center;">
            <button id="openModalBtn" class="btn btn-secondary">üöÄ Select Your Role</button>
        </div>
    </div>

    <!-- Role Selection Modal -->
    <div id="myModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <span class="close-btn" id="closeModal">&times;</span>
                <h2>Choose Your Colony Role</h2>
            </div>
            <div class="modal-body">
                <div class="options-container">
                    <label class="role-option">
                        <input type="radio" name="choice" value="option1">
                        <div class="role-content">
                            <div class="role-title">üîß Base Engineer</div>
                            <ul>
                                <li><strong>Lore:</strong> Responsible for keeping habitats safe, air systems running, and power online.</li>
                                <li><strong>Perks:</strong> +10% efficiency when upgrading base structures.</li>
                                <li>Daily check-ins give extra oxygen resource.</li>
                                <li>Unlocks exclusive "Habitat Module" skins.</li>
                            </ul>
                        </div>
                    </label>

                    <label class="role-option">
                        <input type="radio" name="choice" value="option2">
                        <div class="role-content">
                            <div class="role-title">üõ∞Ô∏è Exploratory Engineer</div>
                            <ul>
                                <li><strong>Lore:</strong> Specialists who adapt rovers, drones, and equipment for expeditions.</li>
                                <li><strong>Perks:</strong> +5% Lunaris earned from exploration tasks.</li>
                                <li>Unlocks early access to the Red Dunes Zone.</li>
                                <li>Rare chance of finding bonus "Martian Mineral NFTs".</li>
                            </ul>
                        </div>
                    </label>

                    <label class="role-option">
                        <input type="radio" name="choice" value="option3">
                        <div class="role-content">
                            <div class="role-title">üå± Food Tech & Survival Expert</div>
                            <ul>
                                <li><strong>Lore:</strong> Masters of hydroponics, rationing, and making Martian soil fertile.</li>
                                <li><strong>Perks:</strong> +10% yield from food/habit tasks.</li>
                                <li>Daily bonus: Hydroponics Tokens.</li>
                                <li>Special recipes (NFTs) to grow rare crops.</li>
                            </ul>
                        </div>
                    </label>

                    <label class="role-option">
                        <input type="radio" name="choice" value="option4">
                        <div class="role-content">
                            <div class="role-title">üì° Comms Specialist</div>
                            <ul>
                                <li><strong>Lore:</strong> Maintains communication networks between colonists and Earth.</li>
                                <li><strong>Perks:</strong> +5% staking rewards.</li>
                                <li>Ability to broadcast colony-wide boosts.</li>
                                <li>Exclusive holographic badges.</li>
                            </ul>
                        </div>
                    </label>

                    <label class="role-option">
                        <input type="radio" name="choice" value="option5">
                        <div class="role-content">
                            <div class="role-title">‚õèÔ∏è Resource Miner</div>
                            <ul>
                                <li><strong>Lore:</strong> Extracts raw materials from Martian crust for colony use.</li>
                                <li><strong>Perks:</strong> +15% efficiency gathering rare resources.</li>
                                <li>Bonus NFT drops on mining missions.</li>
                                <li>Unlocks special trade deals at Crater Nexus.</li>
                            </ul>
                        </div>
                    </label>

                    <label class="role-option">
                        <input type="radio" name="choice" value="option6">
                        <div class="role-content">
                            <div class="role-title">ü©∫ Medical Officer</div>
                            <ul>
                                <li><strong>Lore:</strong> Ensures colonists remain healthy and fit for survival.</li>
                                <li><strong>Perks:</strong> +5% daily boost logging wellness tasks.</li>
                                <li>Ability to "heal" other colonists in co-op missions.</li>
                                <li>Special gear: medical pods as collectibles.</li>
                            </ul>
                        </div>
                    </label>

                    <label class="role-option">
                        <input type="radio" name="choice" value="option7">
                        <div class="role-content">
                            <div class="role-title">üåå Navigator</div>
                            <ul>
                                <li><strong>Lore:</strong> Charts safe paths across dunes, craters, and ice caps.</li>
                                <li><strong>Perks:</strong> Shortens time for exploration quests.</li>
                                <li>Unlocks fast travel between colony zones.</li>
                                <li>Extra bonus tokens for completing streaks.</li>
                            </ul>
                        </div>
                    </label>
                </div>

                <button id="confirmChoiceBtn" class="confirm-btn">‚úì Confirm Selection</button>
            </div>
        </div>
    </div>

    <!-- Instructions Modal -->
    <div id="instructionsModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <span class="close-btn" id="closeInstructions">&times;</span>
                <h2>üöÄ How Lunaris Works</h2>
            </div>
            <div class="modal-body">
                <div class="instructions-section">
                    <h3>üìã Your Mission</h3>
                    <p>Lunaris is a productivity and to-do app with a Mars colony theme. Your role determines the bonuses and perks you receive as you complete tasks and build your colony.</p>

                    <h3>üéØ Core Features</h3>
                    <ul>
                        <li><strong>Task Management:</strong> Create and complete daily missions (to-dos)</li>
                        <li><strong>Role-Based Perks:</strong> Your selected role gives you unique bonuses</li>
                        <li><strong>Progress Tracking:</strong> Track streaks, earn rewards, and level up</li>
                        <li><strong>Colony Building:</strong> Unlock new zones and upgrades as you progress</li>
                    </ul>

                    <h3>‚ö° How Your Role Works</h3>
                    <p id="roleInstructions">Your role is now <strong>permanently locked</strong>. Each time you complete tasks, your role's perks will automatically apply bonus rewards and efficiency boosts.</p>

                    <h3>üéÆ Getting Started</h3>
                    <ol>
                        <li>Create your first mission task</li>
                        <li>Complete tasks to earn Lunaris tokens</li>
                        <li>Track your daily streaks for bonus multipliers</li>
                        <li>Unlock new colony zones and features</li>
                    </ol>

                    <h3>üí° Pro Tips</h3>
                    <ul>
                        <li>Daily check-ins maximize your role's bonus rewards</li>
                        <li>Completing task streaks unlocks special perks</li>
                        <li>Your role's lore adds flavor to your experience</li>
                        <li>Notes page available for journaling and planning</li>
                    </ul>

                    <div style="text-align: center; margin-top: 30px;">
                        <button id="startMissionsBtn" class="btn">üöÄ Start Your Missions!</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Firebase & JavaScript -->
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getDatabase, ref, update } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js';

        const firebaseConfig = {
            apiKey: "AIzaSyClPgII54QDvJB3kiV1dWbqm1et_lHasvs",
            authDomain: "lunaris-45d84.firebaseapp.com",
            projectId: "lunaris-45d84",
            storageBucket: "lunaris-45d84.firebasestorage.app",
            messagingSenderId: "74359858445",
            appId: "1:74359858445:web:37772cebcbb0d71d707c44",
            measurementId: "G-ETRK2NL1N2",
            databaseURL: "https://lunaris-45d84-default-rtdb.firebaseio.com"
        };

        const app = initializeApp(firebaseConfig);
        const database = getDatabase(app);

        // Role data
        const ROLES = {
            'option1': {
                name: 'Base Engineer',
                emoji: 'üîß',
                lore: 'Responsible for keeping habitats safe, air systems running, and power online.',
                perks: {
                    efficiency: 1.10,
                    dailyBonus: 'oxygen',
                    specialUnlock: 'Habitat Module Skins'
                }
            },
            'option2': {
                name: 'Exploratory Engineer',
                emoji: 'üõ∞Ô∏è',
                lore: 'Specialists who adapt rovers, drones, and equipment for expeditions.',
                perks: {
                    earningBoost: 1.05,
                    zoneAccess: 'Red Dunes Zone',
                    specialUnlock: 'Martian Mineral NFTs'
                }
            },
            'option3': {
                name: 'Food Tech & Survival Expert',
                emoji: 'üå±',
                lore: 'Masters of hydroponics, rationing, and making Martian soil fertile.',
                perks: {
                    taskYield: 1.10,
                    dailyBonus: 'hydroponics',
                    specialUnlock: 'Rare Crop Recipes'
                }
            },
            'option4': {
                name: 'Comms Specialist',
                emoji: 'üì°',
                lore: 'Maintains communication networks between colonists and Earth.',
                perks: {
                    stakingBonus: 1.05,
                    colonyBoosts: true,
                    specialUnlock: 'Holographic Badges'
                }
            },
            'option5': {
                name: 'Resource Miner',
                emoji: '‚õèÔ∏è',
                lore: 'Extracts raw materials from Martian crust for colony use.',
                perks: {
                    miningEfficiency: 1.15,
                    nftDrops: true,
                    specialUnlock: 'Crater Nexus Deals'
                }
            },
            'option6': {
                name: 'Medical Officer',
                emoji: 'ü©∫',
                lore: 'Ensures colonists remain healthy and fit for survival.',
                perks: {
                    wellnessBonus: 1.05,
                    healAbility: true,
                    specialUnlock: 'Medical Pods'
                }
            },
            'option7': {
                name: 'Navigator',
                emoji: 'üåå',
                lore: 'Charts safe paths across dunes, craters, and ice caps.',
                perks: {
                    questSpeed: 0.85,
                    fastTravel: true,
                    streakBonus: 1.10
                }
            }
        };

        // Check for existing role or new user
        let currentUser = null;
        let currentRole = null;

        const savedRole = localStorage.getItem('userRole');
        const newUserSignup = localStorage.getItem('newUserSignup');

        if (savedRole) {
            currentRole = JSON.parse(savedRole);
            displayExistingRole();
        } else if (newUserSignup) {
            currentUser = JSON.parse(newUserSignup);
            document.getElementById('userGreeting').textContent = `Welcome, ${currentUser.name}! Select your role to begin.`;
        }

        // Modal management
        const modal = document.getElementById('myModal');
        const instructionsModal = document.getElementById('instructionsModal');
        const openModalBtn = document.getElementById('openModalBtn');
        const closeModal = document.getElementById('closeModal');
        const closeInstructions = document.getElementById('closeInstructions');
        const confirmBtn = document.getElementById('confirmChoiceBtn');
        const progressBtn = document.getElementById('progressBtn');
        const startMissionsBtn = document.getElementById('startMissionsBtn');

        openModalBtn.addEventListener('click', () => {
            modal.style.display = 'block';
        });

        closeModal.addEventListener('click', () => {
            modal.style.display = 'none';
        });

        closeInstructions.addEventListener('click', () => {
            instructionsModal.style.display = 'none';
        });

        window.addEventListener('click', (e) => {
            if (e.target === modal) modal.style.display = 'none';
            if (e.target === instructionsModal) instructionsModal.style.display = 'none';
        });

        // Role selection
        confirmBtn.addEventListener('click', () => {
            const selected = document.querySelector('input[name="choice"]:checked');
            if (!selected) {
                alert('Please select a role first!');
                return;
            }

            const roleValue = selected.value;
            const roleData = ROLES[roleValue];

            saveRole(roleValue, roleData);
        });

        async function saveRole(roleValue, roleData) {
            const roleInfo = {
                value: roleValue,
                name: roleData.name,
                emoji: roleData.emoji,
                lore: roleData.lore,
                perks: roleData.perks,
                selectedAt: Date.now(),
                locked: true
            };

            localStorage.setItem('userRole', JSON.stringify(roleInfo));

            if (currentUser && currentUser.signupId) {
                const userRef = ref(database, `colony-signups/${currentUser.signupId}`);
                await update(userRef, {
                    role: roleValue,
                    roleName: roleData.name,
                    roleSelectedAt: Date.now(),
                    roleLocked: true
                });
            }

            localStorage.removeItem('newUserSignup');
            currentRole = roleInfo;
            modal.style.display = 'none';
            displayExistingRole();
        }

        function displayExistingRole() {
            document.getElementById('openModalBtn').style.display = 'none';
            document.getElementById('roleDisplay').style.display = 'block';
            document.getElementById('currentRoleName').textContent = `${currentRole.emoji} ${currentRole.name}`;
            document.getElementById('currentRoleLore').textContent = currentRole.lore;
        }

        progressBtn.addEventListener('click', () => {
            instructionsModal.style.display = 'block';
        });

        startMissionsBtn.addEventListener('click', () => {
            instructionsModal.style.display = 'none';
            window.location.href = '/Learning JS/dashboard.html';
        });

        // Global functions for other pages
        window.getUserRole = function() {
            const role = localStorage.getItem('userRole');
            return role ? JSON.parse(role) : null;
        };

        window.applyRolePerks = function(baseValue, perkType) {
            const role = window.getUserRole();
            if (role && role.perks[perkType]) {
                return baseValue * role.perks[perkType];
            }
            return baseValue;
        };
    </script>
</body>
</html>
